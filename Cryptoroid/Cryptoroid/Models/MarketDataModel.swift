//
//  MarketDataModel.swift
//  Cryptoroid
//
//  Created by Okan Orkun on 28.07.2025.
//

import Foundation

// JSON Data
/*
 URL: https://api.coingecko.com/api/v3/global
 
 JSON Response:
 
 {
   "data": {
     "active_cryptocurrencies": 17801,
     "upcoming_icos": 0,
     "ongoing_icos": 49,
     "ended_icos": 3376,
     "markets": 1328,
     "total_market_cap": {
       "btc": 33754517.37827079,
       "eth": 1038398491.7626166,
       "ltc": 35663294057.30216,
       "bch": 6811125294.483333,
       "bnb": 4725797691.934721,
       "eos": 6998718682547.58,
       "xrp": 1253509963365.7056,
       "xlm": 9272091893563.844,
       "link": 212477999270.0321,
       "dot": 957799097952.3708,
       "yfi": 707968921.1391484,
       "sol": 20960277801.545826,
       "usd": 4001288217123.5195,
       "aed": 14696851660141.205,
       "ars": 5121694632635985,
       "aud": 6132014205623.968,
       "bdt": 490433703422778.1,
       "bhd": 1508177558662.8489,
       "bmd": 4001288217123.5195,
       "brl": 22342793275596.03,
       "cad": 5491896119224.978,
       "chf": 3208653027752.437,
       "clp": 3830033081430634.5,
       "cny": 28706041927287.566,
       "czk": 84566426211262.17,
       "dkk": 25650870312967.555,
       "eur": 3436950528268.636,
       "gbp": 2979939393261.6567,
       "gel": 10832479523231.217,
       "hkd": 31409676364003.977,
       "huf": 1367251723506325,
       "idr": 65600698607969780,
       "ils": 13405419882911.723,
       "inr": 346829033813907.94,
       "jpy": 592532266115817.9,
       "krw": 5548380348356175,
       "kwd": 1221433241159.126,
       "lkr": 1208529682850847,
       "mmk": 8398703967742269,
       "mxn": 74516774719981.89,
       "myr": 16929450446649.62,
       "ngn": 6124171680718404,
       "nok": 40675983657153.336,
       "nzd": 6693330921874.922,
       "php": 228853675577091.6,
       "pkr": 1133767625161867.2,
       "pln": 14638905004180.824,
       "rub": 321508998013308.9,
       "sar": 15009000156535.447,
       "sek": 38298114100634.04,
       "sgd": 5141063168347.589,
       "thb": 129678418043888.44,
       "try": 162248043854307.25,
       "twd": 118523302647845.9,
       "uah": 167439175142115.7,
       "vef": 400648989180.57794,
       "vnd": 104859759662047540,
       "zar": 71402239993672.62,
       "xdr": 2774533262635.6206,
       "xag": 104999484646.58951,
       "xau": 1202387109.245618,
       "bits": 33754517378270.79,
       "sats": 3375451737827079
     },
     "total_volume": {
       "btc": 1334257.2838934935,
       "eth": 41046083.867582954,
       "ltc": 1409707901.622163,
       "bch": 269231920.39255166,
       "bnb": 186802552.1446215,
       "eos": 276647160303.406,
       "xrp": 49549065694.25344,
       "xlm": 366509643947.134,
       "link": 8398885251.893954,
       "dot": 37860130205.03855,
       "yfi": 27984778.428744894,
       "sol": 828523276.3288381,
       "usd": 158163954436.83765,
       "aed": 580940949565.138,
       "ars": 202451668702331.62,
       "aud": 242387841813.9982,
       "bdt": 19385990139498.938,
       "bhd": 59615632198.19618,
       "bmd": 158163954436.83765,
       "brl": 883171705179.8583,
       "cad": 217085088711.10165,
       "chf": 126832465882.67235,
       "clp": 151394537186941.06,
       "cny": 1134699841920.7612,
       "czk": 3342763544231.677,
       "dkk": 1013934229002.3771,
       "eur": 135856668467.02055,
       "gbp": 117791814247.06271,
       "gel": 428189049321.22003,
       "hkd": 1241569802458.1426,
       "huf": 54045079375912.03,
       "idr": 2593081363460140.5,
       "ils": 529892900614.83093,
       "inr": 13709547656867.02,
       "jpy": 23421768504262.02,
       "krw": 219317811913712.84,
       "kwd": 48281128731.38908,
       "lkr": 47771073544759.49,
       "mmk": 331986140362922.3,
       "mxn": 2945518323612.299,
       "myr": 669191691222.2604,
       "ngn": 242077840463301.94,
       "nok": 1607850791225.558,
       "nzd": 264575713998.21545,
       "php": 9046187215850.98,
       "pkr": 44815859612576.26,
       "pln": 578650419176.9838,
       "rub": 12708690739945.4,
       "sar": 593279635978.6647,
       "sek": 1513857749038.6519,
       "sgd": 203217273186.07977,
       "thb": 5125962012723.864,
       "try": 6413382596589.52,
       "twd": 4685019729264.539,
       "uah": 6618578975337.467,
       "vef": 15836956757.760551,
       "vnd": 4144923671948987,
       "zar": 2822406190265.889,
       "xdr": 109672467646.04764,
       "xag": 4150446757.2379217,
       "xau": 47528268.30826973,
       "bits": 1334257283893.4934,
       "sats": 133425728389349.34
     },
     "market_cap_percentage": {
       "btc": 58.95098631671609,
       "eth": 11.640801013799216,
       "xrp": 4.748822465915311,
       "usdt": 4.088771252622378,
       "bnb": 2.947069812146975,
       "sol": 2.5660258805464604,
       "usdc": 1.604286761135304,
       "doge": 0.8993940312106301,
       "steth": 0.8625437811537678,
       "trx": 0.7709083602247921
     },
     "market_cap_change_percentage_24h_usd": -3.5002588914995343,
     "updated_at": 1753709190
   }
 }
 */

struct GlobalDataModel: Codable {
    let data: MarketDataModel
}

struct MarketDataModel: Codable {
    let totalMarketCap, totalVolume, marketCapPercentage: [String: Double]
    let marketCapChangePercentage24HUsd: Double

    enum CodingKeys: String, CodingKey {
        case totalMarketCap = "total_market_cap"
        case totalVolume = "total_volume"
        case marketCapPercentage = "market_cap_percentage"
        case marketCapChangePercentage24HUsd = "market_cap_change_percentage_24h_usd"
    }
    
    var marketCap: String {
        
        if let item = totalMarketCap.first(where: { $0.key == "usd"}) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var volume: String {
        if let item = totalVolume.first(where: { $0.key == "usd"}) {
            return "$" + item.value.formattedWithAbbreviations()
        }
        return ""
    }
    
    var btcDominance: String {
        if let item = marketCapPercentage.first(where: { $0.key == "btc"}) {
            return item.value.asPercentString()
        }
        return ""
    }
}
